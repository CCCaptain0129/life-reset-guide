<template>
  <div class="interview">
    <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
    <div class="progress-container">
      <div class="progress-header">
        <button class="back-button" @click="goBack" v-if="currentStep > 1">
          â† è¿”å›
        </button>
        <div class="progress-info">
          <span class="step-counter">æ­¥éª¤ {{ currentStep }} / {{ totalSteps }}</span>
          <span class="step-title">{{ currentStepData.title }}</span>
        </div>
      </div>
      
      <ProgressBar
        :value="currentStep"
        :max="totalSteps"
        :height="'6px'"
        :color="'primary'"
        :striped="true"
        :animated="true"
        :show-label="false"
        :show-info="false"
      />
    </div>
    
    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div class="interview-content">
      <div class="step-content">
        <!-- æ­¥éª¤è¯´æ˜ -->
        <div class="step-description">
          <h2 class="step-question">{{ currentStepData.question }}</h2>
          <p class="step-hint" v-if="currentStepData.hint">{{ currentStepData.hint }}</p>
        </div>
        
        <!-- å›ç­”åŒºåŸŸ -->
        <div class="answer-area">
          <textarea
            v-model="answers[currentStep - 1]"
            :placeholder="currentStepData.placeholder"
            class="answer-input"
            rows="6"
            @input="saveAnswer"
          ></textarea>
          
          <div class="answer-actions">
            <button 
              class="skip-button"
              @click="skipQuestion"
              v-if="currentStepData.allowSkip"
            >
              è·³è¿‡è¿™ä¸ªé—®é¢˜
            </button>
            
            <div class="character-count" v-if="answers[currentStep - 1]">
              {{ answers[currentStep - 1].length }} å­—
            </div>
          </div>
        </div>
        
        <!-- å¯¼èˆªæŒ‰é’® -->
        <div class="navigation-buttons">
          <Button
            v-if="currentStep > 1"
            variant="outline"
            size="large"
            :rounded="true"
            @click="prevStep"
            class="nav-button"
          >
            ä¸Šä¸€æ­¥
          </Button>
          
          <Button
            :variant="canProceed ? 'primary' : 'outline'"
            size="large"
            :rounded="true"
            :block="currentStep === 1"
            @click="nextStep"
            :disabled="!canProceed && !currentStepData.allowSkip"
            class="nav-button next-button"
          >
            <template #default>
              <span class="button-content">
                <span>{{ currentStep === totalSteps ? 'å®Œæˆè®¿è°ˆ' : 'ç»§ç»­ä¸‹ä¸€æ­¥' }}</span>
                <span class="button-arrow" v-if="currentStep < totalSteps">â†’</span>
                <span class="button-check" v-else>âœ“</span>
              </span>
            </template>
          </Button>
        </div>
        
        <!-- æ­¥éª¤æç¤º -->
        <div class="step-tips" v-if="currentStepData.tips">
          <div class="tips-header">
            <span class="tips-icon">ğŸ’¡</span>
            <span class="tips-title">æç¤º</span>
          </div>
          <p class="tips-content">{{ currentStepData.tips }}</p>
        </div>
      </div>
    </div>
    
    <!-- åº•éƒ¨ä¿¡æ¯ -->
    <div class="interview-footer">
      <p class="footer-text">
        ä½ çš„å›ç­”ä¼šè‡ªåŠ¨ä¿å­˜ï¼Œå¯ä»¥éšæ—¶è¿”å›ä¿®æ”¹ã€‚
        <span class="privacy-note">æˆ‘ä»¬ä¸ä¼šä¿å­˜ä»»ä½•ä¸ªäººèº«ä»½ä¿¡æ¯ã€‚</span>
      </p>
    </div>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import { useRouter } from 'vue-router'
import ProgressBar from '@/components/common/ProgressBar.vue'
import Button from '@/components/common/Button.vue'

const router = useRouter()

// è®¿è°ˆæ­¥éª¤æ•°æ®
const steps = [
  {
    id: 1,
    title: 'ç°çŠ¶è¯„ä¼°',
    question: 'è¯·æè¿°ä½ å½“å‰çš„ç”Ÿæ´»çŠ¶æ€ã€‚ä½ å¯¹å“ªäº›æ–¹é¢æ„Ÿåˆ°æ»¡æ„ï¼Œå“ªäº›æ–¹é¢å¸Œæœ›æ”¹è¿›ï¼Ÿ',
    hint: 'å¯ä»¥ä»å·¥ä½œã€å¥åº·ã€äººé™…å…³ç³»ã€ä¸ªäººæˆé•¿ç­‰æ–¹é¢æ€è€ƒ',
    placeholder: 'ä¾‹å¦‚ï¼šæˆ‘å¯¹å½“å‰çš„å·¥ä½œæ¯”è¾ƒæ»¡æ„ï¼Œä½†æ„Ÿè§‰ç¼ºä¹ä¸ªäººæˆé•¿ç©ºé—´ã€‚å¥åº·æ–¹é¢éœ€è¦æ”¹å–„ï¼Œç»å¸¸ç†¬å¤œ...',
    tips: 'è¯šå®é¢å¯¹è‡ªå·±ï¼Œè¿™æ˜¯é‡æ–°è®¾è®¡ç”Ÿæ´»çš„ç¬¬ä¸€æ­¥ã€‚',
    allowSkip: false
  },
  {
    id: 2,
    title: 'ä»·å€¼è§‚æ¾„æ¸…',
    question: 'å¯¹ä½ æ¥è¯´ï¼Œç”Ÿæ´»ä¸­æœ€é‡è¦çš„æ˜¯ä»€ä¹ˆï¼Ÿè¯·åˆ—å‡º3-5ä¸ªæ ¸å¿ƒä»·å€¼è§‚ã€‚',
    hint: 'ä¾‹å¦‚ï¼šå®¶åº­ã€å¥åº·ã€è‡ªç”±ã€æˆé•¿ã€è´¡çŒ®ã€å†’é™©ç­‰',
    placeholder: '1. å¥åº· - èº«ä½“å’Œå¿ƒç†çš„å¥åº·æ˜¯åŸºç¡€\n2. æˆé•¿ - æŒç»­å­¦ä¹ å’Œè¿›æ­¥\n3. è‡ªç”± - æ—¶é—´å’Œé€‰æ‹©çš„è‡ªç”±...',
    tips: 'ä»·å€¼è§‚æ˜¯ä½ åšå†³ç­–çš„æŒ‡å—é’ˆï¼Œæ˜ç¡®å®ƒä»¬å¾ˆé‡è¦ã€‚',
    allowSkip: true
  },
  {
    id: 3,
    title: 'æ„¿æ™¯æ„å»º',
    question: 'æƒ³è±¡ä¸€ä¸‹ï¼Œ3å¹´åçš„ç†æƒ³ç”Ÿæ´»æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿè¯·å…·ä½“æè¿°ã€‚',
    hint: 'è¶Šå…·ä½“è¶Šå¥½ï¼ŒåŒ…æ‹¬ç”Ÿæ´»ã€å·¥ä½œã€äººé™…å…³ç³»ã€ä¸ªäººçŠ¶æ€ç­‰',
    placeholder: '3å¹´åï¼Œæˆ‘å¸Œæœ›ï¼š\n- æ‹¥æœ‰ä¸€ä»½æœ‰æ„ä¹‰çš„å·¥ä½œï¼Œæ¯å¤©å……æ»¡æ¿€æƒ…\n- ä¿æŒå¥åº·çš„ç”Ÿæ´»æ–¹å¼ï¼Œæ¯å‘¨è¿åŠ¨3æ¬¡\n- ä¸å®¶äººæœ‹å‹å…³ç³»æ›´åŠ äº²å¯†...',
    tips: 'æ„¿æ™¯æ˜¯ä½ å‰è¿›çš„æ–¹å‘ï¼Œå¤§èƒ†æƒ³è±¡ï¼Œä¸è¦è®¾é™ã€‚',
    allowSkip: false
  },
  {
    id: 4,
    title: 'éšœç¢åˆ†æ',
    question: 'è¦å®ç°è¿™ä¸ªæ„¿æ™¯ï¼Œä½ è®¤ä¸ºæœ€å¤§çš„éšœç¢æ˜¯ä»€ä¹ˆï¼Ÿ',
    hint: 'å¯ä»¥ä»å†…éƒ¨éšœç¢ï¼ˆä¹ æƒ¯ã€ä¿¡å¿µï¼‰å’Œå¤–éƒ¨éšœç¢ï¼ˆèµ„æºã€ç¯å¢ƒï¼‰æ€è€ƒ',
    placeholder: 'ä¸»è¦éšœç¢å¯èƒ½åŒ…æ‹¬ï¼š\n- æ—¶é—´ç®¡ç†èƒ½åŠ›ä¸è¶³\n- ç¼ºä¹ç›¸å…³æŠ€èƒ½\n- ç»æµå‹åŠ›\n- å®³æ€•å¤±è´¥çš„å¿ƒç†...',
    tips: 'è¯†åˆ«éšœç¢æ˜¯å…‹æœå®ƒä»¬çš„ç¬¬ä¸€æ­¥ã€‚',
    allowSkip: true
  },
  {
    id: 5,
    title: 'è¡ŒåŠ¨è®¡åˆ’',
    question: 'åŸºäºä»¥ä¸Šåˆ†æï¼Œä½ çš„ç¬¬ä¸€ä¸ªå…·ä½“è¡ŒåŠ¨æ˜¯ä»€ä¹ˆï¼Ÿä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼Ÿ',
    hint: 'ä»å°å¤„å¼€å§‹ï¼Œåˆ¶å®šä¸€ä¸ªå…·ä½“ã€å¯æ‰§è¡Œçš„ç¬¬ä¸€æ­¥',
    placeholder: 'æˆ‘çš„ç¬¬ä¸€ä¸ªè¡ŒåŠ¨æ˜¯ï¼š\nä»æ˜å¤©å¼€å§‹ï¼Œæ¯å¤©æ—©æ™¨6ç‚¹èµ·åºŠï¼Œé”»ç‚¼30åˆ†é’Ÿã€‚\nè¿™èƒ½æ”¹å–„æˆ‘çš„å¥åº·å’Œç²¾åŠ›ï¼Œä¸ºå…¶ä»–æ”¹å˜æ‰“ä¸‹åŸºç¡€ã€‚',
    tips: 'åƒé‡Œä¹‹è¡Œå§‹äºè¶³ä¸‹ï¼Œé‡è¦çš„æ˜¯å¼€å§‹è¡ŒåŠ¨ã€‚',
    allowSkip: false
  }
]

// çŠ¶æ€ç®¡ç†
const currentStep = ref(1)
const answers = ref(Array(steps.length).fill(''))

const totalSteps = steps.length

// è®¡ç®—å±æ€§
const currentStepData = computed(() => {
  return steps[currentStep.value - 1]
})

const canProceed = computed(() => {
  const answer = answers.value[currentStep.value - 1]
  return answer && answer.trim().length > 10 // è‡³å°‘10ä¸ªå­—ç¬¦
})

// æ–¹æ³•
const saveAnswer = () => {
  // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
  localStorage.setItem('lifeResetAnswers', JSON.stringify(answers.value))
}

const loadAnswers = () => {
  const saved = localStorage.getItem('lifeResetAnswers')
  if (saved) {
    try {
      answers.value = JSON.parse(saved)
    } catch (e) {
      console.error('åŠ è½½ç­”æ¡ˆå¤±è´¥:', e)
    }
  }
}

const nextStep = () => {
  if (currentStep.value < totalSteps) {
    currentStep.value++
  } else {
    // å®Œæˆè®¿è°ˆï¼Œè·³è½¬åˆ°ç»“æœé¡µé¢
    completeInterview()
  }
}

const prevStep = () => {
  if (currentStep.value > 1) {
    currentStep.value--
  }
}

const skipQuestion = () => {
  if (!answers.value[currentStep.value - 1]) {
    answers.value[currentStep.value - 1] = 'æˆ‘é€‰æ‹©è·³è¿‡è¿™ä¸ªé—®é¢˜ã€‚'
  }
  nextStep()
}

const goBack = () => {
  if (currentStep.value === 1) {
    router.push('/')
  } else {
    prevStep()
  }
}

const completeInterview = () => {
  // ä¿å­˜æœ€ç»ˆç­”æ¡ˆ
  saveAnswer()
  
  // è·³è½¬åˆ°ç»“æœé¡µé¢ï¼ˆæš‚æ—¶å›åˆ°é¦–é¡µï¼‰
  alert('æ­å–œï¼ä½ å·²å®Œæˆäººç”Ÿé‡ç½®è®¿è°ˆã€‚ä¸‹ä¸€æ­¥å°†ä¸ºä½ ç”Ÿæˆä¸ªæ€§åŒ–çš„äººç”Ÿé‡ç½®åœ°å›¾ã€‚')
  router.push('/')
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadAnswers()
})
</script>

<style scoped>
.interview {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}

/* è¿›åº¦å®¹å™¨ */
.progress-container {
  background: white;
  padding: 1rem 1.5rem;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
  position: sticky;
  top: 0;
  z-index: 100;
}

.progress-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.75rem;
}

.back-button {
  background: none;
  border: none;
  color: #667eea;
  font-size: 0.95rem;
  cursor: pointer;
  padding: 0.5rem;
  border-radius: 6px;
  transition: background-color 0.2s ease;
}

.back-button:hover {
  background: #f8f9fa;
}

.progress-info {
  flex: 1;
  text-align: center;
}

.step-counter {
  display: block;
  font-size: 0.9rem;
  color: #666;
  margin-bottom: 0.25rem;
}

.step-title {
  display: block;
  font-size: 1.1rem;
  font-weight: 600;
  color: #2c3e50;
}

/* ä¸»è¦å†…å®¹ */
.interview-content {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem 1rem;
}

.step-content {
  max-width: 700px;
  width: 100%;
  background: white;
  border-radius: 16px;
  padding: 2.5rem;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

/* æ­¥éª¤è¯´æ˜ */
.step-description {
  margin-bottom: 2rem;
}

.step-question {
  font-size: 1.8rem;
  color: #2c3e50;
  line-height: 1.4;
  margin-bottom: 1rem;
}

.step-hint {
  font-size: 1.1rem;
  color: #666;
  line-height: 1.5;
}

/* å›ç­”åŒºåŸŸ */
.answer-area {
  margin-bottom: 2rem;
}

.answer-input {
  width: 100%;
  padding: 1.5rem;
  border: 2px solid #e9ecef;
  border-radius: 12px;
  font-size: 1.1rem;
  line-height: 1.6;
  resize: vertical;
  transition: border-color 0.3s ease;
  font-family: inherit;
}

.answer-input:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.answer-input::placeholder {
  color: #adb5bd;
}

.answer-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 0.75rem;
}

.skip-button {
  background: none;
  border: none;
  color: #6c757d;
  font-size: 0.95rem;
  cursor: pointer;
  padding: 0.5rem 1rem;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.skip-button:hover {
  background: #f8f9fa;
  color: #495057;
}

.character-count {
  font-size: 0.9rem;
  color: #6c757d;
}

/* å¯¼èˆªæŒ‰é’® */
.navigation-buttons {
  display: flex;
  gap: 1rem;
  margin-bottom: 2rem;
}

.nav-button {
  flex: 1;
}

.next-button {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border: none;
  color: white;
}

.next-button:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.button-content {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  font-size: 1.1rem;
  font-weight: 600;
}

.button-arrow,
.button-check {
  font-size: 1.2rem;
}

/* æ­¥éª¤æç¤º */
.step-tips {
  padding: 1.5rem;
  background: #f8f9fa;
  border-radius: 12px;
  border-left: 4px solid #ffc107;
}

.tips-header {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin-bottom: 0.75rem;
}

.tips-icon {
  font-size: 1.2rem;
}

.tips-title {
  font-weight: 600;
  color: #2c3e50;
}

.tips-content {
  color: #666;
  line-height: 1.6;
  margin: 0;
}

/* åº•éƒ¨ä¿¡æ¯ */
.interview-footer {
  padding: 1.5rem;
  text-align: center;
  background: white;
  border-top: 1px solid #e9ecef;
}

.footer-text {
  color: #666;
  font-size: 0.95rem;
  line-height: 1.5;
}

.privacy-note {
  color: #28a745;
  font-weight: 500;
}

/* å“åº”å¼è°ƒæ•´ */
@media (max-width: 768px) {
  .step-content {
    padding: 1.5rem;
  }
  
  .step-question {
    font-size: 1.5rem;
  }
  
  .step-hint {
    font-size: 1rem;
  }
  
  .answer-input {
    padding: 1rem;
    font-size: 1rem;
  }
  
  .navigation-buttons {
    flex-direction: column;
  }
  
  .nav-button {
    width: 100%;
  }
  
  .progress-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.5rem;
  }
  
  .back-button {
    align-self: flex-start;
  }
  
  .progress-info {
    text-align: left;
  }
}

/* æ·±è‰²æ¨¡å¼æ”¯æŒ */
@media (prefers-color-scheme: dark) {
  .interview {
    background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
  }
  
  .progress-container,
  .step-content,
  .interview-footer {
    background: #2d3748;
  }
  
  .step-question {
    color: #e2e8f0;
  }
  
  .step-hint {
    color: #a0aec0;
  }
  
  .answer-input {
    background: #4a5568;
    border-color: #4a5568;
    color: #e2e8f0;
  }
  
  .answer-input:focus {
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
  }
  
  .answer-input::placeholder {
    color: #718096;
  }
  
  .skip-button:hover {
    background: #4a5568;
    color: #e2e8f0;
  }
  
  .character-count {
    color: #a0aec0;
  }
  
  .step-tips {
    background: #4a5568;
    border-left-color: #d69e2e;
  }
  
  .tips-title {
    color: #e2e8f0;
  }
  
  .tips-content {
    color: #cbd5e0;
  }
  
  .interview-footer {
    border-top-color: #4a5568;
  }
  
  .footer-text {
    color: #a0aec0;
  }
  
  .back-button {
    color: #90cdf4;
  }
  
  .back-button:hover {
    background: #4a5568;
  }
  
  .step-title {
    color: #e2e8f0;
  }
  
  .step-counter {
    color: #a0aec0;
  }
}
</style>